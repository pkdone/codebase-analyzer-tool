<html>
  <head>
    <title>Codebase Analysis Tools (CAT) Report</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <h1>Codebase Analysis Tools (CAT) Report <a href="<%= jsonFilesConfig.jsonDataFiles.completeReport %>.json" target="_blank" style="font-size: 0.7em; margin-left: 10px; text-decoration: none; color: #007cba;">[JSON]</a></h1>
    <hr/>
    <%- include('partials/app-statistics', { appStats: appStats, jsonFilesConfig: jsonFilesConfig }) %>
    <%- include('partials/file-types-summary', { fileTypesData: fileTypesData, fileTypesPieChartPath: fileTypesPieChartPath, fileTypesTableViewModel: fileTypesTableViewModel, jsonFilesConfig: jsonFilesConfig }) %>
    
    <!-- Enhanced sections with diagrams and tables -->
    <% if (businessProcessesFlowchartSvgs && businessProcessesFlowchartSvgs.length > 0) { %>
      <%- include('partials/business-processes', { 
        label: 'Existing Business Processes', 
        jsonFile: jsonFilesConfig.getCategoryJSONFilename('businessProcesses'),
        data: categorizedData.find(c => c.category === 'businessProcesses')?.data || [],
        flowchartSvgs: businessProcessesFlowchartSvgs,
        tableViewModel: categorizedData.find(c => c.category === 'businessProcesses')?.tableViewModel
      }) %>
    <% } %>
    
    <% if (domainModelData && domainModelData.boundedContexts.length > 0) { %>
      <%- include('partials/domain-model-diagrams', { 
        domainModelData: domainModelData,
        contextDiagramSvgs: contextDiagramSvgs
      }) %>
    <% } %>
    
    <% if (microservicesData && microservicesData.length > 0) { %>
      <%- include('partials/microservices-architecture', { 
        microservicesData: microservicesData,
        architectureDiagramSvg: architectureDiagramSvg,
        microservicesTableViewModel: microservicesTableViewModel,
        integrationPointsTableViewModel: integrationPointsTableViewModel
      }) %>
    <% } %>
    
    <!-- Regular categorized data sections -->
    <% categorizedData.forEach(category => { %>
      <% if (category.category === 'technologies') { %>
        <%- include('partials/technologies', { 
          label: category.label, 
          jsonFile: jsonFilesConfig.getCategoryJSONFilename(category.category),
          data: category.data 
        }) %>
      <% } else if (!['businessProcesses', 'boundedContexts', 'aggregates', 'entities', 'repositories', 'potentialMicroservices'].includes(category.category)) { %>
        <%- include('partials/category-table', { 
          category: category.category, 
          label: category.label, 
          data: category.data, 
          tableViewModel: category.tableViewModel, 
          convertToDisplayName: convertToDisplayName, 
          jsonFilesConfig: jsonFilesConfig 
        }) %>
      <% } %>
    <% }); %>
    <%- include('partials/section-header', { title: 'Bill of Materials (Dependencies)', jsonFile: 'bill-of-materials.json' }) %>
    <%- include('partials/bom', { bomData: billOfMaterials, bomStats: bomStatistics }) %>
    <%- include('partials/section-header', { title: 'Code Quality Summary', jsonFile: 'code-quality-summary.json' }) %>
    <%- include('partials/code-quality', { codeQualitySummary: codeQualitySummary }) %>
    <% if (scheduledJobsSummary && scheduledJobsSummary.jobs.length > 0) { %>
      <%- include('partials/section-header', { title: 'Scheduled Jobs and Batch Processes', jsonFile: 'scheduled-jobs-summary.json' }) %>
      <%- include('partials/scheduled-jobs', { jobsData: scheduledJobsSummary, jobsStats: jobsStatistics }) %>
    <% } %>
    <% if (moduleCoupling && moduleCoupling.couplings.length > 0) { %>
      <%- include('partials/section-header', { title: 'Module Coupling Analysis', jsonFile: 'module-coupling.json' }) %>
      <%- include('partials/module-coupling', { couplingData: moduleCoupling, couplingStats: couplingStatistics }) %>
    <% } %>
    <%- include('partials/section-header', { title: 'UI Technology Deep-Dive Analysis', jsonFile: 'ui-technology-analysis.json' }) %>
    <%- include('partials/ui-analysis', { uiData: uiTechnologyAnalysis }) %>
    <%- include('partials/top-level-java-classes', { topLevelJavaClasses: topLevelJavaClasses, topLevelJavaClassesTableViewModel: topLevelJavaClassesTableViewModel, jsonFilesConfig: jsonFilesConfig }) %>
    <%- include('partials/integration-points', { integrationPoints: integrationPoints, integrationPointsTableViewModel: integrationPointsTableViewModel, jsonFilesConfig: jsonFilesConfig }) %>
    <%- include('partials/db-integrations', { dbInteractions: dbInteractions, procsAndTriggers: procsAndTriggers, dbInteractionsTableViewModel: dbInteractionsTableViewModel, procsAndTriggersTableViewModel: procsAndTriggersTableViewModel, convertToDisplayName: convertToDisplayName, jsonFilesConfig: jsonFilesConfig }) %>
  </body>
</html> 