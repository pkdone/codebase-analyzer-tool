<% if (codeQualitySummary) { %>
<p class="note-paragraph">
  This section provides code quality metrics to help identify complex, hard-to-maintain code.
  Metrics are estimated by AI and should be verified manually.
</p>

<h3>Overall Statistics</h3>
<table>
  <thead>
    <tr>
      <th class="col-medium">Metric</th>
      <th class="col-small numeric">Value</th>
      <th class="col-description">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Total Functions/Methods Analyzed</td>
      <td class="numeric"><%= codeQualitySummary.overallStatistics.totalFunctions %></td>
      <td>Total number of functions/methods analyzed across the codebase</td>
    </tr>
    <tr>
      <td>Average Complexity</td>
      <td class="numeric"><%= codeQualitySummary.overallStatistics.averageComplexity %></td>
      <td>Average cyclomatic complexity (1-10: simple, 11-20: moderate, >20: complex)</td>
    </tr>
    <tr>
      <td>High Complexity Functions/Methods</td>
      <td class="numeric"><%= codeQualitySummary.overallStatistics.highComplexityCount %></td>
      <td>Functions/methods with complexity > 10 (candidate for refactoring)</td>
    </tr>
    <tr>
      <td>Very High Complexity</td>
      <td class="numeric"><%= codeQualitySummary.overallStatistics.veryHighComplexityCount %></td>
      <td>Functions/methods with complexity > 20 (high priority for refactoring)</td>
    </tr>
    <tr>
      <td>Average Function/Method Length</td>
      <td class="numeric"><%= codeQualitySummary.overallStatistics.averageFunctionLength %> LOC</td>
      <td>Average lines of code per function/method</td>
    </tr>
    <tr>
      <td>Long Functions/Methods</td>
      <td class="numeric"><%= codeQualitySummary.overallStatistics.longFunctionCount %></td>
      <td>Functions/methods with > 50 lines of code</td>
    </tr>
  </tbody>
</table>

<h3>Top 10 Most Complex Functions/Methods</h3>
<p>These functions/methods have the highest cyclomatic complexity and should be prioritized for refactoring.</p>
<table>
  <thead>
    <tr>
      <th class="col-wide">Function/Method Name</th>
      <th class="col-medium">File Path</th>
      <th class="col-small numeric">Complexity</th>
      <th class="col-small numeric">Lines</th>
      <th class="col-description">Code Smells</th>
    </tr>
  </thead>
  <tbody>
    <% codeQualitySummary.topComplexFunctions.forEach(func => { %>
    <tr>
      <td><code><%= func.functionName %></code></td>
      <td><code><%= func.filePath %></code></td>
      <td class="numeric"><%= func.complexity %></td>
      <td class="numeric"><%= func.linesOfCode %></td>
      <td>
        <% if (func.codeSmells && func.codeSmells.length > 0) { %>
          <ul>
            <% func.codeSmells.forEach(smell => { %>
              <li><%= smell %></li>
            <% }); %>
          </ul>
        <% } else { %>
          None detected
        <% } %>
      </td>
    </tr>
    <% }); %>
  </tbody>
</table>

<h3>Most Common Code Smells</h3>
<p>Frequently occurring code quality issues across the codebase.</p>
<table>
  <thead>
    <tr>
      <th class="col-wide">Code Smell Type</th>
      <th class="col-small numeric">Occurrences</th>
      <th class="col-small numeric">Affected Files</th>
      <th class="col-description">Recommendation</th>
    </tr>
  </thead>
  <tbody>
    <% codeQualitySummary.commonCodeSmells.slice(0, 15).forEach(smell => { %>
    <tr>
      <td><strong><%= smell.smellType %></strong></td>
      <td class="numeric"><%= smell.occurrences %></td>
      <td class="numeric"><%= smell.affectedFiles %></td>
      <td>
        <% if (smell.smellType.includes('Long Method')) { %>
          Refactor into smaller, single-purpose methods
        <% } else if (smell.smellType.includes('God Class')) { %>
          Split into multiple classes following Single Responsibility Principle
        <% } else if (smell.smellType.includes('Duplicate Code')) { %>
          Extract common code into reusable functions or utilities
        <% } else if (smell.smellType.includes('Long Parameter List')) { %>
          Use parameter objects or builder pattern
        <% } else if (smell.smellType.includes('Complex Conditional')) { %>
          Simplify conditionals or extract into guard clauses
        <% } else { %>
          Review and refactor as part of modernization effort
        <% } %>
      </td>
    </tr>
    <% }); %>
  </tbody>
</table>
<% } else { %>
<p class="note-paragraph">
  Code quality metrics are not available. Run the insights generation step to analyze code quality.
</p>
<% } %>


