<% if (uiData) { %>
  <div class="ui-summary">
    <p class="stats">
      <strong>JSP Files:</strong> <%= uiData.totalJspFiles %> |
      <strong>Total Scriptlets:</strong> 
      <span class="<%= uiData.totalScriptletsCssClass %>">
        <%= uiData.totalScriptlets %>
      </span> |
      <strong>Avg Scriptlets/File:</strong> <%= uiData.averageScriptletsPerFile.toFixed(1) %> |
      <strong>High Debt Files:</strong> 
      <span class="<%= uiData.filesWithHighScriptletCountCssClass %>">
        <%= uiData.filesWithHighScriptletCount %>
      </span>
    </p>
  </div>

  <% if (uiData.showHighDebtAlert) { %>
    <div class="alert alert-warning">
      <strong>⚠️ High Technical Debt Detected!</strong> 
      <%= uiData.filesWithHighScriptletCount %> <%= uiData.filesWithHighScriptletCount === 1 ? 'file has' : 'files have' %> 
      more than 10 scriptlet blocks. Consider refactoring to modern UI patterns (JSP tags, JSF components, or React/Vue).
    </div>
  <% } %>

  <!-- UI Frameworks Detected -->
  <% if (uiData.frameworks && uiData.frameworks.length > 0) { %>
    <h3>Detected UI Frameworks</h3>
    <table class="data-table frameworks-table">
      <thead>
        <tr>
          <th>Framework</th>
          <th>Version</th>
          <th>Configuration Files</th>
        </tr>
      </thead>
      <tbody>
        <% uiData.frameworks.forEach(function(framework) { %>
          <tr>
            <td class="framework-name"><%= framework.name %></td>
            <td class="framework-version"><%= framework.version || 'Unknown' %></td>
            <td class="config-files">
              <% if (framework.configFiles.length === 1) { %>
                <%= framework.configFiles[0] %>
              <% } else { %>
                <details>
                  <summary><%= framework.configFiles.length %> files</summary>
                  <ul>
                    <% framework.configFiles.forEach(function(file) { %>
                      <li><%= file %></li>
                    <% }); %>
                  </ul>
                </details>
              <% } %>
            </td>
          </tr>
        <% }); %>
      </tbody>
    </table>
  <% } else { %>
    <p class="no-data">No UI frameworks detected in configuration files.</p>
  <% } %>

  <!-- Top JSP Files with High Scriptlet Count -->
  <% if (uiData.topScriptletFiles && uiData.topScriptletFiles.length > 0) { %>
    <h3>Top JSP Files by Scriptlet Count (Technical Debt Hotspots)</h3>
    <table class="data-table scriptlets-table">
      <thead>
        <tr>
          <th>File Path</th>
          <th>Scriptlets</th>
          <th>Expressions</th>
          <th>Declarations</th>
          <th>Total Blocks</th>
          <th>Debt Level</th>
        </tr>
      </thead>
      <tbody>
        <% uiData.topScriptletFiles.forEach(function(file) { %>
          <tr>
            <td class="file-path">
              <details class="expandable-path">
                <summary><%= file.filePath.split('/').pop() %></summary>
                <code><%= file.filePath %></code>
              </details>
            </td>
            <td class="metric-count"><%= file.scriptletCount %></td>
            <td class="metric-count"><%= file.expressionCount %></td>
            <td class="metric-count"><%= file.declarationCount %></td>
            <td class="total-count"><strong><%= file.totalScriptletBlocks %></strong></td>
            <td class="debt-indicator">
              <span class="badge <%= file.debtLevelClass %>"><%= file.debtLevel %></span>
            </td>
          </tr>
        <% }); %>
      </tbody>
    </table>
  <% } %>

  <!-- Custom Tag Libraries -->
  <% if (uiData.customTagLibraries && uiData.customTagLibraries.length > 0) { %>
    <h3>Custom Tag Libraries Used</h3>
    <table class="data-table taglibs-table">
      <thead>
        <tr>
          <th>Prefix</th>
          <th>URI</th>
          <th>Usage Count</th>
          <th>Type</th>
        </tr>
      </thead>
      <tbody>
        <% uiData.customTagLibraries.forEach(function(taglib) { %>
          <tr>
            <td class="tag-prefix"><code><%= taglib.prefix %></code></td>
            <td class="tag-uri"><%= taglib.uri %></td>
            <td class="usage-count"><%= taglib.usageCount %> <%= taglib.usageCount === 1 ? 'file' : 'files' %></td>
            <td class="tag-type">
              <span class="badge <%= taglib.tagTypeClass %>"><%= taglib.tagType %></span>
            </td>
          </tr>
        <% }); %>
      </tbody>
    </table>
  <% } %>

  <!-- Summary Statistics -->
  <% if (uiData.totalJspFiles > 0) { %>
    <div class="ui-insights">
      <h3>UI Modernization Insights</h3>
      <ul>
        <li>
          <strong>Scriptlet Usage:</strong> 
          <% if (uiData.totalScriptlets === 0) { %>
            No scriptlets detected - excellent! The codebase follows modern JSP best practices.
          <% } else if (uiData.averageScriptletsPerFile < 5) { %>
            Low scriptlet usage (<%= uiData.averageScriptletsPerFile.toFixed(1) %> per file). 
            Consider further refactoring to eliminate remaining scriptlets.
          <% } else if (uiData.averageScriptletsPerFile < 10) { %>
            Moderate scriptlet usage (<%= uiData.averageScriptletsPerFile.toFixed(1) %> per file). 
            Refactoring to tag libraries or modern UI framework recommended.
          <% } else { %>
            High scriptlet usage (<%= uiData.averageScriptletsPerFile.toFixed(1) %> per file). 
            Significant refactoring needed for modernization.
          <% } %>
        </li>
        <% if (uiData.totalExpressions > 0) { %>
          <li>
            <strong>Expressions:</strong> <%= uiData.totalExpressions %> JSP expressions found. 
            These can often be replaced with EL (Expression Language) for cleaner code.
          </li>
        <% } %>
        <% if (uiData.customTagLibraries.length > 0) { %>
          <li>
            <strong>Tag Libraries:</strong> <%= uiData.customTagLibraries.length %> different tag libraries in use. 
            Review custom tag libraries for migration planning.
          </li>
        <% } %>
        <% if (uiData.frameworks.length === 0 && uiData.totalJspFiles > 0) { %>
          <li class="warning-item">
            <strong>⚠️ No UI Framework Detected:</strong> 
            The application appears to use raw JSP without a modern UI framework. 
            Consider migrating to a framework like JSF, Spring MVC, or a modern JavaScript framework.
          </li>
        <% } %>
      </ul>
    </div>
  <% } %>

<% } else { %>
  <p class="no-data">No UI technology data available. This might be a non-web application or JSP files were not analyzed.</p>
<% } %>
