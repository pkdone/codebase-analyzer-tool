<% if (couplingData && couplingData.couplings.length > 0) { %>
  <div class="stats-grid">
    <div class="card">
      <span class="card-title">Total Modules</span>
      <span class="card-value"><%= couplingStats.totalModules %></span>
    </div>
    <div class="card">
      <span class="card-title">Coupling Relationships</span>
      <span class="card-value"><%= couplingStats.totalCouplings %></span>
    </div>
    <div class="card">
      <span class="card-title">Highest Coupling</span>
      <span class="card-value"><%= couplingStats.highestCouplingCount %></span>
    </div>
    <div class="card">
      <span class="card-title">Module Depth</span>
      <span class="card-value"><%= couplingStats.moduleDepth %></span>
    </div>
  </div>

  <div class="note-box">
    <p><strong>Interpretation:</strong> High reference counts indicate tightly coupled modules (candidates for single services). Low reference counts indicate loosely coupled modules (candidates for easy separation).</p>
  </div>

  <table class="data-table">
    <thead>
      <tr>
        <th>From Module</th>
        <th>To Module</th>
        <th class="coupling-count">Reference Count</th>
        <th class="coupling-level">Coupling Level</th>
      </tr>
    </thead>
    <tbody>
      <% couplingData.couplings.forEach(function(coupling) { 
        // Calculate coupling level based on reference count
        let couplingLevel = '';
        let couplingClass = '';
        if (coupling.referenceCount >= couplingStats.highestCouplingCount * 0.7) {
          couplingLevel = 'Very High';
          couplingClass = 'badge-danger';
        } else if (coupling.referenceCount >= couplingStats.highestCouplingCount * 0.4) {
          couplingLevel = 'High';
          couplingClass = 'badge-high';
        } else if (coupling.referenceCount >= couplingStats.highestCouplingCount * 0.2) {
          couplingLevel = 'Medium';
          couplingClass = 'badge-warning';
        } else {
          couplingLevel = 'Low';
          couplingClass = 'badge-success';
        }
      %>
        <tr>
          <td class="module-name from-module">
            <code><%= coupling.fromModule %></code>
          </td>
          <td class="module-name to-module">
            <code><%= coupling.toModule %></code>
          </td>
          <td class="coupling-count">
            <strong><%= coupling.referenceCount %></strong>
          </td>
          <td class="coupling-level">
            <span class="badge <%= couplingClass %>"><%= couplingLevel %></span>
          </td>
        </tr>
      <% }); %>
    </tbody>
  </table>

  <div class="note-box">
    <h4>Coupling Level Guide:</h4>
    <ul>
      <li><span class="badge badge-danger">Very High</span> - Strong coupling, consider keeping in same service</li>
      <li><span class="badge badge-high">High</span> - Significant coupling, requires careful design if separated</li>
      <li><span class="badge badge-warning">Medium</span> - Moderate coupling, separation feasible with clear interfaces</li>
      <li><span class="badge badge-success">Low</span> - Weak coupling, good candidate for separation</li>
    </ul>
  </div>
<% } else { %>
  <p class="note-paragraph">No module coupling analysis data available. This may indicate that no internal references were found in the codebase.</p>
<% } %>

